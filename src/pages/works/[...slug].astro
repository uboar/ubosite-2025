---
import { getCollection, render } from 'astro:content';
import Layout from '@layouts/Layout.astro';
import TableOfContents from '@components/TableOfContents.astro';
import { extractTocFromMarkdown } from '@utils/toc';

export async function getStaticPaths() {
  const works = await getCollection('works');
  return works.map(work => ({
    params: { slug: work.data.slug },
    props: { work },
  }));
}

const { work } = Astro.props;
const { Content } = await render(work);

// ç›®æ¬¡ã‚’æŠ½å‡º
const toc = extractTocFromMarkdown(work.body);
---

<Layout 
  title={`${work.data.title} - UBO SITE`}
  description={work.data.description}
  currentPath={`/works/${work.data.slug}`}
  backgroundPattern="main"
>
  <div class="container">
    <div class="py-8">
      <nav class="mb-8">
        <a href="/works/" class="btn btn-outline btn-sm motion-preset-slide-right-sm">â† ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªä¸€è¦§ã«æˆ»ã‚‹</a>
      </nav>
    
      <div class="lg:flex lg:gap-8 xl:gap-12">
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <article class="lg:w-3/4 min-w-0">
          <header class="mb-12 motion-preset-slide-up-sm">
            <div class="mb-6">
              <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold leading-tight break-words">{work.data.title}</h1>
            </div>
            
            <div class="flex flex-wrap items-center gap-4 text-text-muted mb-6 text-sm sm:text-base">
              <time class="blog-card-date" datetime={work.data.pubDate.toISOString()}>
                é–‹å§‹æ—¥: {work.data.pubDate.toLocaleDateString('ja-JP')}
              </time>
              {work.data.updatedDate && (
                <span>
                  æ›´æ–°æ—¥: {work.data.updatedDate.toLocaleDateString('ja-JP')}
                </span>
              )}
            </div>
            
            {work.data.description && (
              <p class="text-lg sm:text-xl text-text-secondary mb-8 leading-relaxed">{work.data.description}</p>
            )}
            
            {work.data.tags && work.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-2 mb-8">
                {work.data.tags.map((tag) => (
                  <span class="project-card-tech-tag">
                    {tag}
                  </span>
                ))}
              </div>
            )}
            
            {work.data.image && (
              <div class="mb-8">
                <img 
                  src={work.data.image.url} 
                  alt={work.data.image.alt}
                  class="w-full h-auto rounded-xl shadow-lg max-w-full"
                />
              </div>
            )}
            
            {work.data.projectUrl && (
              <div class="mb-8">
                <a 
                  href={work.data.projectUrl} 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="btn btn-primary btn-lg"
                >
                  ğŸ”— ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¦‹ã‚‹
                </a>
              </div>
            )}
          </header>
          
          <div class="prose prose-base sm:prose-lg lg:prose-xl prose-invert max-w-full motion-preset-slide-up-sm overflow-hidden" style="animation-delay: 0.2s">
            <Content />
          </div>
        </article>
        
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆç›®æ¬¡ï¼‰ -->
        <aside class="lg:w-1/4 lg:min-w-0 mt-12 lg:mt-0">
          <div class="lg:sticky lg:top-24 motion-preset-slide-up-sm" style="animation-delay: 0.3s">
            <TableOfContents toc={toc} />
          </div>
        </aside>
      </div>
    </div>
  </div>
</Layout>