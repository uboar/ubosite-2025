---
import { getCollection } from "astro:content";
import "@styles/global.css";
import Header from "@components/Header.astro";
import fs from 'fs';
import path from 'path';

const pageTitle = "ãƒªãƒ³ã‚¯ãƒ„ãƒªãƒ¼";
const allLinks = await getCollection("links");

// contentãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ã‚¢ã‚¤ã‚³ãƒ³ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
const getIconContent = (iconPath: string) => {
  try {
    const fullPath = path.join(process.cwd(), 'src/content/icons', iconPath);
    return fs.readFileSync(fullPath, 'utf-8');
  } catch (error) {
    console.warn(`Icon not found: ${iconPath}`);
    return null;
  }
};

// ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒªãƒ³ã‚¯ã®ã¿ã‚’å–å¾—ã—ã€å„ªå…ˆåº¦é †ã«ã‚½ãƒ¼ãƒˆ
const activeLinks = allLinks
  .filter(link => link.data.isActive)
  .sort((a, b) => b.data.priority - a.data.priority);

// ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
const groupedLinks = activeLinks.reduce((acc, link) => {
  const category = link.data.category;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(link);
  return acc;
}, {} as Record<string, typeof activeLinks>);

// ã‚«ãƒ†ã‚´ãƒªã®æ—¥æœ¬èªåãƒãƒƒãƒ”ãƒ³ã‚°
const categoryNames: Record<string, string> = {
  social: "ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢",
  portfolio: "ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª",
  blog: "ãƒ–ãƒ­ã‚°ãƒ»è¨˜äº‹",
  contact: "ãŠå•ã„åˆã‚ã›",
  other: "ãã®ä»–"
};
---

<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{pageTitle}</title>
		<meta name="description" content="ç§ã®ãƒªãƒ³ã‚¯ãƒ„ãƒªãƒ¼ - ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ã€ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã€ãƒ–ãƒ­ã‚°ãªã©ã¸ã®ãƒªãƒ³ã‚¯é›†" />
	</head>
	<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
		<Header currentPath="/link" />
		<main class="p-8">
			<div class="max-w-md mx-auto">
				<!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
				<div class="text-center mb-8">
					<div class="w-24 h-24 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center">
						<span class="text-white text-2xl font-bold">ğŸš€</span>
					</div>
					<h1 class="text-2xl font-bold text-gray-900 mb-2">My Links</h1>
					<p class="text-gray-600">ã™ã¹ã¦ã®ãƒªãƒ³ã‚¯ãŒã“ã“ã«ã‚ã‚Šã¾ã™</p>
				</div>

				<!-- ãƒªãƒ³ã‚¯ä¸€è¦§ -->
				<div class="space-y-6">
					{Object.entries(groupedLinks).map(([category, links]) => (
						<div>
							<h2 class="text-lg font-semibold text-gray-800 mb-3 text-center">
								{categoryNames[category] || category}
							</h2>
							<div class="space-y-3">
								{links.map((link) => (
									<a
										href={link.data.url}
										target="_blank"
										rel="noopener noreferrer"
										class="block w-full p-4 rounded-xl border-2 border-white bg-white/80 backdrop-blur-sm hover:bg-white hover:shadow-lg hover:scale-105 transition-all duration-300 group"
										style={link.data.backgroundColor ? `background-color: ${link.data.backgroundColor}` : ''}
									>
										<div class="flex items-center justify-between">
											<div class="flex items-center space-x-3">
												{/* ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º - ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«å„ªå…ˆã€æ¬¡ã«çµµæ–‡å­— */}
												{link.data.iconImage ? (
													<div 
														class="flex-shrink-0"
														style={`width: ${link.data.iconSize}px; height: ${link.data.iconSize}px;`}
														set:html={getIconContent(link.data.iconImage)}
													/>
												) : link.data.icon && (
													<span class="text-2xl flex-shrink-0">{link.data.icon}</span>
												)}
												<div>
													<h3 
														class="font-semibold text-gray-900 group-hover:text-blue-600 transition-colors"
														style={link.data.textColor ? `color: ${link.data.textColor}` : ''}
													>
														{link.data.title}
													</h3>
													{link.data.description && (
														<p 
															class="text-sm text-gray-600"
															style={link.data.textColor ? `color: ${link.data.textColor}; opacity: 0.8` : ''}
														>
															{link.data.description}
														</p>
													)}
												</div>
											</div>
											<svg 
												class="w-5 h-5 text-gray-400 group-hover:text-blue-600 transition-colors" 
												fill="none" 
												stroke="currentColor" 
												viewBox="0 0 24 24"
											>
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
											</svg>
										</div>
									</a>
								))}
							</div>
						</div>
					))}
				</div>

				<!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
				<div class="text-center mt-12 pb-8">
					<p class="text-sm text-gray-500">
						Â© 2025 My Site. Made with 
						<a href="https://astro.build" target="_blank" class="text-blue-600 hover:underline">Astro</a>
					</p>
				</div>
			</div>
		</main>

		<script>
			// ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åŠ¹æœ
			document.addEventListener('DOMContentLoaded', () => {
				const linkElements = document.querySelectorAll('a[href^="http"]');
				
				linkElements.forEach(link => {
					link.addEventListener('click', (e) => {
						const target = e.currentTarget as HTMLElement;
						
						// ã‚¯ãƒªãƒƒã‚¯åŠ¹æœ
						target.style.transform = 'scale(0.98)';
						setTimeout(() => {
							target.style.transform = '';
						}, 150);
					});
				});
			});

			// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®ãƒ‘ãƒ©ãƒ©ãƒƒã‚¯ã‚¹åŠ¹æœï¼ˆè»½å¾®ï¼‰
			let ticking = false;
			
			function updateParallax() {
				const scrolled = window.pageYOffset;
				const parallax = document.body;
				const speed = scrolled * 0.5;
				
				parallax.style.transform = `translateY(${speed}px)`;
				ticking = false;
			}
			
			function requestTick() {
				if (!ticking) {
					requestAnimationFrame(updateParallax);
					ticking = true;
				}
			}
			
			window.addEventListener('scroll', requestTick);
		</script>

		<style>
			/* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
			body {
				background-image: 
					radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
					radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
					radial-gradient(circle at 40% 80%, rgba(120, 200, 255, 0.3) 0%, transparent 50%);
			}
			
			/* ãƒ›ãƒãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
			@keyframes bounce {
				0%, 20%, 50%, 80%, 100% {
					transform: translateY(0);
				}
				40% {
					transform: translateY(-10px);
				}
				60% {
					transform: translateY(-5px);
				}
			}
			
			.animate-bounce-custom:hover {
				animation: bounce 1s;
			}
			
			/* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒœãƒ¼ãƒ€ãƒ¼ */
			.gradient-border {
				background: linear-gradient(white, white) padding-box,
							linear-gradient(45deg, #3b82f6, #8b5cf6) border-box;
				border: 2px solid transparent;
			}
		</style>
	</body>
</html>