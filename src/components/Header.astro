---
interface Props {
  currentPath?: string;
}

const { currentPath = '' } = Astro.props;

// ç¾åœ¨ã®ãƒ‘ã‚¹ã«åŸºã¥ã„ã¦ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒªãƒ³ã‚¯ã‚’åˆ¤å®š
const isActive = (path: string) => {
  if (path === '/' && currentPath === '/') return true;
  if (path !== '/' && currentPath.startsWith(path)) return true;
  return false;
};
---

<header class="header" id="header">
  <nav class="nav-container">
    <!-- ãƒ­ã‚´/ã‚µã‚¤ãƒˆå -->
    <a href="/" class="logo motion-preset-slide-down-sm">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2L2 7L12 12L22 7L12 2Z"/>
        <path d="M2 17L12 22L22 17"/>
        <path d="M2 12L12 17L22 12"/>
      </svg>
      UBO SITE
    </a>

    <!-- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="nav-menu">
      <a 
        href="/" 
        class={`nav-link motion-preset-slide-down-sm ${isActive('/') ? 'active' : ''}`}
        style="animation-delay: 0.1s"
      >
        ãƒ›ãƒ¼ãƒ 
      </a>
      <a 
        href="/blog" 
        class={`nav-link motion-preset-slide-down-sm ${isActive('/blog') ? 'active' : ''}`}
        style="animation-delay: 0.2s"
      >
        ãƒ–ãƒ­ã‚°
      </a>
      <a 
        href="/works" 
        class={`nav-link motion-preset-slide-down-sm ${isActive('/works') ? 'active' : ''}`}
        style="animation-delay: 0.3s"
      >
        ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª
      </a>
      <a 
        href="/link" 
        class={`nav-link motion-preset-slide-down-sm ${isActive('/link') ? 'active' : ''}`}
        style="animation-delay: 0.4s"
      >
        ãƒªãƒ³ã‚¯
      </a>
    </div>

    <!-- ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ -->
    <button 
      id="mobile-menu-button"
      type="button" 
      class="mobile-menu-button motion-preset-slide-down-sm"
      aria-controls="mobile-menu" 
      aria-expanded="false"
      style="animation-delay: 0.1s"
    >
      <span class="sr-only">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã</span>
      <!-- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ -->
      <svg class="hamburger-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <!-- é–‰ã˜ã‚‹ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰ -->
      <svg class="close-icon hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <!-- ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div class="mobile-menu" id="mobile-menu">
      <div class="mobile-menu-content">
        <a 
          href="/" 
          class={`mobile-nav-link ${isActive('/') ? 'active' : ''}`}
        >
          ğŸ  ãƒ›ãƒ¼ãƒ 
        </a>
        <a 
          href="/blog" 
          class={`mobile-nav-link ${isActive('/blog') ? 'active' : ''}`}
        >
          ğŸ“ ãƒ–ãƒ­ã‚°
        </a>
        <a 
          href="/works" 
          class={`mobile-nav-link ${isActive('/works') ? 'active' : ''}`}
        >
          ğŸ’¼ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª
        </a>
        <a 
          href="/link" 
          class={`mobile-nav-link ${isActive('/link') ? 'active' : ''}`}
        >
          ğŸ”— ãƒªãƒ³ã‚¯
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  // ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é–‹é–‰æ©Ÿèƒ½ã¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ¤œçŸ¥
  const header = document.getElementById('header');
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  
  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ¤œçŸ¥ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´
  let lastScrollY = window.scrollY;
  
  window.addEventListener('scroll', () => {
    const currentScrollY = window.scrollY;
    
    if (currentScrollY > 100) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
    
    lastScrollY = currentScrollY;
  });
  
  // ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ¶å¾¡
  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', () => {
      const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
      const hamburgerIcon = mobileMenuButton.querySelector('.hamburger-icon');
      const closeIcon = mobileMenuButton.querySelector('.close-icon');
      
      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
      if (isExpanded) {
        mobileMenu.classList.remove('open');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        hamburgerIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
      } else {
        mobileMenu.classList.add('open');
        mobileMenuButton.setAttribute('aria-expanded', 'true');
        hamburgerIcon?.classList.add('hidden');
        closeIcon?.classList.remove('hidden');
      }
    });

    // ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
    const mobileLinks = mobileMenu.querySelectorAll('.mobile-nav-link');
    mobileLinks.forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu.classList.remove('open');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        const hamburgerIcon = mobileMenuButton.querySelector('.hamburger-icon');
        const closeIcon = mobileMenuButton.querySelector('.close-icon');
        hamburgerIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
      });
    });

    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    document.addEventListener('click', (e) => {
      if (!header?.contains(e.target as Node)) {
        mobileMenu.classList.remove('open');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        const hamburgerIcon = mobileMenuButton.querySelector('.hamburger-icon');
        const closeIcon = mobileMenuButton.querySelector('.close-icon');
        hamburgerIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
      }
    });
  }
</script>