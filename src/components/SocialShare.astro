---
export interface Props {
  title: string;
  url: string;
  description?: string;
}

const { title, url, description = "" } = Astro.props;

// SNSシェアURL生成
const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`;
const copyText = 'URLをコピー';
---

<div class="social-share">
  <h3 class="social-share__title">SHARE</h3>
  <div class="social-share__buttons">
    <a 
      href={twitterUrl}
      target="_blank"
      rel="noopener noreferrer"
      class="btn btn-outline btn-sm social-share__button"
      aria-label="Twitterでシェア"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
      </svg>
    </a>
    
    <button 
      class="btn btn-outline btn-sm social-share__button social-share__copy"
      aria-label="URLをコピー"
      data-url={url}
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
      </svg>
      {copyText}
    </button>
  </div>
</div>

<style>
.social-share {
  margin-top: 2rem;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 107, 53, 0.2);
  border-radius: 1rem;
}

.social-share__title {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0 0 1rem 0;
}

.social-share__buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
}

.social-share__button {
  flex: 1;
  min-width: 120px;
  justify-content: center;
}

.social-share__copy.copied {
  background: rgba(34, 197, 94, 0.1);
  color: #22c55e;
  border-color: #22c55e;
}

@media (max-width: 639px) {
  .social-share {
    margin-top: 1.5rem;
    padding: 1rem;
  }
  
  .social-share__buttons {
    flex-direction: column;
  }
  
  .social-share__button {
    flex: none;
    width: 100%;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const copyButtons = document.querySelectorAll('.social-share__copy');
  
  copyButtons.forEach(button => {
    button.addEventListener('click', async () => {
      const url = button.dataset.url;
      if (!url) return;
      
      try {
        await navigator.clipboard.writeText(url);
        
        const originalText = button.textContent.trim();
        button.textContent = 'コピーしました！';
        button.classList.add('copied');
        
        setTimeout(() => {
          button.textContent = originalText;
          button.classList.remove('copied');
        }, 2000);
      } catch (err) {
        console.error('URLのコピーに失敗しました:', err);
        
        // フォールバック: 選択してコピーする方法
        const textArea = document.createElement('textarea');
        textArea.value = url;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        const originalText = button.textContent.trim();
        button.textContent = 'コピーしました！';
        button.classList.add('copied');
        
        setTimeout(() => {
          button.textContent = originalText;
          button.classList.remove('copied');
        }, 2000);
      }
    });
  });
});
</script>